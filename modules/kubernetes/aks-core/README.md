# AKS Core

This module is used to create AKS clusters.

## Requirements

| Name                                                                         | Version |
| ---------------------------------------------------------------------------- | ------- |
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform)    | 0.14.7  |
| <a name="requirement_azuread"></a> [azuread](#requirement\_azuread)          | 1.4.0   |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm)          | 2.53.0  |
| <a name="requirement_flux"></a> [flux](#requirement\_flux)                   | 0.1.1   |
| <a name="requirement_github"></a> [github](#requirement\_github)             | 4.6.0   |
| <a name="requirement_helm"></a> [helm](#requirement\_helm)                   | 2.0.3   |
| <a name="requirement_kubectl"></a> [kubectl](#requirement\_kubectl)          | 1.10.0  |
| <a name="requirement_kubernetes"></a> [kubernetes](#requirement\_kubernetes) | 2.0.3   |
| <a name="requirement_random"></a> [random](#requirement\_random)             | 3.1.0   |

## Providers

| Name                                                                   | Version |
| ---------------------------------------------------------------------- | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm)          | 2.53.0  |
| <a name="provider_kubernetes"></a> [kubernetes](#provider\_kubernetes) | 2.0.3   |

## Modules

| Name                             | Source                                            | Version |
| -------------------------------- | ------------------------------------------------- | ------- |
| aad_pod_identity                 | ../../kubernetes/aad-pod-identity                 |         |
| azad_kube_proxy                  | ../../kubernetes/azad-kube-proxy                  |         |
| cert_manager                     | ../../kubernetes/cert-manager                     |         |
| csi_secrets_store_provider_azure | ../../kubernetes/csi-secrets-store-provider-azure |         |
| datadog                          | ../../kubernetes/datadog                          |         |
| external_dns                     | ../../kubernetes/external-dns                     |         |
| falco                            | ../../kubernetes/falco                            |         |
| fluxcd_v1_azure_devops           | ../../kubernetes/fluxcd-v1                        |         |
| fluxcd_v2_azure_devops           | ../../kubernetes/fluxcd-v2-azdo                   |         |
| fluxcd_v2_github                 | ../../kubernetes/fluxcd-v2-github                 |         |
| ingress_nginx                    | ../../kubernetes/ingress-nginx                    |         |
| kyverno                          | ../../kubernetes/kyverno                          |         |
| opa_gatekeeper                   | ../../kubernetes/opa-gatekeeper                   |         |
| prometheus                       | ../../kubernetes/prometheus                       |         |
| reloader                         | ../../kubernetes/reloader                         |         |
| velero                           | ../../kubernetes/velero                           |         |

## Resources

| Name                                                                                                                                                    | Type        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [kubernetes_cluster_role.helm_release](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role)                  | resource    |
| [kubernetes_cluster_role.list_namespaces](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role)               | resource    |
| [kubernetes_cluster_role.toolkit_helm_release](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role)          | resource    |
| [kubernetes_cluster_role.toolkit_kustomization](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role)         | resource    |
| [kubernetes_cluster_role_binding.cluster_admin](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role_binding) | resource    |
| [kubernetes_cluster_role_binding.cluster_view](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role_binding)  | resource    |
| [kubernetes_cluster_role_binding.edit_list_ns](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role_binding)  | resource    |
| [kubernetes_cluster_role_binding.view_list_ns](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/cluster_role_binding)  | resource    |
| [kubernetes_limit_range.this](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/limit_range)                            | resource    |
| [kubernetes_namespace.service_accounts](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/namespace)                    | resource    |
| [kubernetes_namespace.tenant](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/namespace)                              | resource    |
| [kubernetes_network_policy.tenant](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/network_policy)                    | resource    |
| [kubernetes_role_binding.edit](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)                          | resource    |
| [kubernetes_role_binding.helm_release](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)                  | resource    |
| [kubernetes_role_binding.sa_edit](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)                       | resource    |
| [kubernetes_role_binding.sa_helm_release](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)               | resource    |
| [kubernetes_role_binding.toolkit_helm_release](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)          | resource    |
| [kubernetes_role_binding.toolkit_kustomization](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)         | resource    |
| [kubernetes_role_binding.view](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/role_binding)                          | resource    |
| [kubernetes_service_account.tenant](https://registry.terraform.io/providers/hashicorp/kubernetes/2.0.3/docs/resources/service_account)                  | resource    |
| [azurerm_client_config.current](https://registry.terraform.io/providers/hashicorp/azurerm/2.53.0/docs/data-sources/client_config)                       | data source |
| [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/2.53.0/docs/data-sources/resource_group)                        | data source |

## Inputs

| Name                                          | Description                                                        | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Default                                                                                                                                                                                                                                                                                                                            | Required |
| --------------------------------------------- | ------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| aad\_groups                                   | Configuration for aad groups                                       | <pre>object({<br>    view = map(any)<br>    edit = map(any)<br>    cluster_admin = object({<br>      id   = string<br>      name = string<br>    })<br>    cluster_view = object({<br>      id   = string<br>      name = string<br>    })<br>    aks_managed_identity = object({<br>      id   = string<br>      name = string<br>    })<br>  })</pre>                                                                                                                      | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| aad\_pod\_identity\_config                    | Configuration for aad pod identity                                 | <pre>map(object({<br>    id        = string<br>    client_id = string<br>  }))</pre>                                                                                                                                                                                                                                                                                                                                                                                         | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| aad\_pod\_identity\_enabled                   | Should aad-pod-identity be enabled                                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| aks\_name\_suffix                             | The suffix for the aks clusters                                    | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| azad\_kube\_proxy\_config                     | The azad-kube-proxy configuration                                  | <pre>object({<br>    fqdn                  = string<br>    dashboard             = string<br>    azure_ad_group_prefix = string<br>    allowed_ips           = list(string)<br>    azure_ad_app = object({<br>      client_id     = string<br>      client_secret = string<br>      tenant_id     = string<br>    })<br>    k8dash_config = object({<br>      client_id     = string<br>      client_secret = string<br>      scope         = string<br>    })<br>  })</pre> | <pre>{<br>  "allowed_ips": [],<br>  "azure_ad_app": {<br>    "client_id": "",<br>    "client_secret": "",<br>    "tenant_id": ""<br>  },<br>  "azure_ad_group_prefix": "",<br>  "dashboard": "",<br>  "fqdn": "",<br>  "k8dash_config": {<br>    "client_id": "",<br>    "client_secret": "",<br>    "scope": ""<br>  }<br>}</pre> |    no    |
| azad\_kube\_proxy\_enabled                    | Should azad-kube-proxy be enabled                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |
| cert\_manager\_config                         | Cert Manager configuration                                         | <pre>object({<br>    notification_email = string<br>    dns_zone           = string<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                            | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| cert\_manager\_enabled                        | Should Cert Manager be enabled                                     | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| csi\_secrets\_store\_provider\_azure\_enabled | Should csi-secrets-store-provider-azure be enabled                 | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| datadog\_config                               | Datadog configuration                                              | <pre>object({<br>    datadog_site = string<br>    api_key      = string<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                        | <pre>{<br>  "api_key": "",<br>  "datadog_site": ""<br>}</pre>                                                                                                                                                                                                                                                                      |    no    |
| datadog\_enabled                              | Should Datadog be enabled                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |
| environment                                   | The environment name to use for the deploy                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| external\_dns\_config                         | External DNS configuration                                         | <pre>object({<br>    client_id   = string<br>    resource_id = string<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                          | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| external\_dns\_enabled                        | Should External DNS be enabled                                     | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| falco\_enabled                                | Should Falco be enabled                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |
| fluxcd\_v1\_config                            | Configuration for fluxcd-v1                                        | <pre>object({<br>    flux_status_enabled = bool<br>    branch              = string<br>    azure_devops = object({<br>      pat  = string<br>      org  = string<br>      proj = string<br>    })<br>  })</pre>                                                                                                                                                                                                                                                              | <pre>{<br>  "azure_devops": {<br>    "org": "",<br>    "pat": "",<br>    "proj": ""<br>  },<br>  "branch": "main",<br>  "flux_status_enabled": false<br>}</pre>                                                                                                                                                                    |    no    |
| fluxcd\_v1\_enabled                           | Should fluxcd-v1 be enabled                                        | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |
| fluxcd\_v2\_config                            | Configuration for fluxcd-v2                                        | <pre>object({<br>    type = string<br>    github = object({<br>      owner = string<br>    })<br>    azure_devops = object({<br>      pat  = string<br>      org  = string<br>      proj = string<br>    })<br>  })</pre>                                                                                                                                                                                                                                                    | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| fluxcd\_v2\_enabled                           | Should fluxcd-v2 be enabled                                        | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| ingress\_config                               | Ingress configuration                                              | <pre>object({<br>    http_snipet = string<br>  })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                      | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| ingress\_nginx\_enabled                       | Should Ingress NGINX be enabled                                    | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| kubernetes\_default\_limit\_range             | Default limit range for tenant namespaces                          | <pre>object({<br>    default_request = object({<br>      cpu    = string<br>      memory = string<br>    })<br>    default = object({<br>      memory = string<br>    })<br>  })</pre>                                                                                                                                                                                                                                                                                       | <pre>{<br>  "default": {<br>    "memory": "256Mi"<br>  },<br>  "default_request": {<br>    "cpu": "50m",<br>    "memory": "32Mi"<br>  }<br>}</pre>                                                                                                                                                                                 |    no    |
| kubernetes\_network\_policy\_default\_deny    | If network policies should by default deny cross namespace traffic | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |
| kyverno\_enabled                              | Should Kyverno be enabled                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| location\_short                               | The Azure region short name.                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| name                                          | The commonName to use for the deploy                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| namespaces                                    | The namespaces that should be created in Kubernetes.               | <pre>list(<br>    object({<br>      name   = string<br>      labels = map(string)<br>      flux = object({<br>        enabled     = bool<br>        create_crds = bool<br>        azure_devops = object({<br>          org  = string<br>          proj = string<br>          repo = string<br>        })<br>        github = object({<br>          repo = string<br>        })<br>      })<br>    })<br>  )</pre>                                                            | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| opa\_gatekeeper\_config                       | Configuration for OPA Gatekeeper                                   | <pre>object({<br>    enable_default_constraints = bool<br>    additional_constraints = list(object({<br>      excluded_namespaces = list(string)<br>      processes           = list(string)<br>    }))<br>  })</pre>                                                                                                                                                                                                                                                        | <pre>{<br>  "additional_constraints": [],<br>  "enable_default_constraints": true<br>}</pre>                                                                                                                                                                                                                                       |    no    |
| opa\_gatekeeper\_enabled                      | Should OPA Gatekeeper be enabled                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| prometheus\_config                            | Configuration for prometheus                                       | <pre>object({<br>    alertmanager_enabled   = bool<br>    remote_write_enabled   = bool<br>    remote_write_url       = string<br>    remote_write_name      = string<br>    remote_tls_secret_name = string<br><br>    volume_claim_enabled            = bool<br>    volume_claim_storage_class_name = string<br>    volume_claim_size               = string<br>  })</pre>                                                                                                 | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| prometheus\_enabled                           | Should prometheus be enabled                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| reloader\_enabled                             | Should Reloader be enabled                                         | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`                                                                                                                                                                                                                                                                                                                             |    no    |
| velero\_config                                | Velero configuration                                               | <pre>object({<br>    azure_storage_account_name      = string<br>    azure_storage_account_container = string<br>    identity = object({<br>      client_id   = string<br>      resource_id = string<br>    })<br>  })</pre>                                                                                                                                                                                                                                                 | n/a                                                                                                                                                                                                                                                                                                                                |   yes    |
| velero\_enabled                               | Should Velero be enabled                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `false`                                                                                                                                                                                                                                                                                                                            |    no    |

## Outputs

No outputs.
